- **Cita√ß√£o**
  - **T√≠tulo**: Null-Conditional Assignment in C# ‚Äì A Cleaner Way to Handle Nulls in .NET 10
  - **Autor**: Arunkumar
  - **Fonte**: Arunkumar Blog
  - **URL**: https://www.arungudelli.com/csharp-tips/null-conditional-assignment-in-csharp/
  - **Atualizado**: 16 de abril de 2025

---

# üí° Atribui√ß√£o Nula-Condicional em C# ‚Äì Uma Maneira Mais Limpa de Lidar com Nulos no .NET 10

Ao trabalhar com o mais recente **.NET 10 Preview 3**, me deparei com um novo recurso de linguagem no C# 14 que simplifica a maneira como atribu√≠mos valores a objetos anul√°veis: **atribui√ß√£o nula-condicional**.

√â uma pequena adi√ß√£o, mas ajuda a reduzir verifica√ß√µes repetitivas de nulos e deixa seu c√≥digo mais limpo.

Deixe-me mostrar como isso funciona com um exemplo simples.

## üå± O Problema: Verifica√ß√µes Nulas Repetitivas

```c#
public class Customer
{
    public string Name { get; set; }
    public int Age { get; set; }
}

public class UpdateCustomer
{
    public static void UpdateAge(Customer? customer, int newAge)
    {
        if (customer is not null)
        {
            customer.Age = newAge;
        }
    }
}
```

Essa √© uma abordagem perfeitamente v√°lida, mas parece um pouco prolixa para uma tarefa t√£o simples.

Estamos apenas garantindo que o objeto n√£o seja nulo antes de executar uma atribui√ß√£o.

## ‚ú® A Nova Maneira: Atribui√ß√£o Nula-Condicional

```c#
public static void UpdateAge(Customer? customer, int newAge)
{
    customer?.Age = newAge;
}
```

O operador `?.` garante que a atribui√ß√£o aconte√ßa **somente se `customer` n√£o for nulo**.

Se for nulo, nada acontece ‚Äî nenhuma exce√ß√£o, nenhum erro, apenas um salto silencioso.

### ‚ö† Ô∏è Nota: Isso falharia em vers√µes anteriores

Se voc√™ tentar usar essa sintaxe em vers√µes anteriores do C# (anteriores ao C# 14), voc√™ receber√° um erro do compilador como:

`O lado esquerdo de uma atribui√ß√£o deve ser uma vari√°vel, propriedade ou indexador`

Isso ocorre porque `customer?.Age` n√£o era considerado um alvo atribu√≠vel v√°lido at√© o C# 14.

## ‚úÖ O que isso significa para o seu c√≥digo

- üîç Remove a necessidade de verifica√ß√µes manuais de nulos
- üßº Torna as tarefas mais concisas
- üõ°Ô∏è Protege contra `NullReferenceException`
- üí° Suportado por IDEs (quando totalmente dispon√≠vel)

Exemplo de uso:

```c#
order?.Status = "Shipped";
user?.LastLogin = DateTime.UtcNow;
config?.RetryCount = 3;
```

## üß™ Exemplo do mundo real

Vamos simular um caso de uso pr√°tico: um aplicativo recebe dados opcionais de perfil de usu√°rio de uma API e queremos atualiz√°-los somente se os dados existirem.

### üß± Classes de suporte: `UserProfile` e `ProfileService`

```c#
using System;

namespace NullConditionalAssignmentDemo
{
    public class UserProfile
    {
        public string? DisplayName { get; set; }
        public string? Bio { get; set; }
        public int Age { get; set; }

        public void Print()
        {
            Console.WriteLine($"DisplayName: {DisplayName ?? "N/A"}");
            Console.WriteLine($"Bio: {Bio ?? "N/A"}");
            Console.WriteLine($"Age: {Age}");
        }
    }

    public class ProfileService
    {
        public UserProfile? GetProfileFromApi(string username)
        {
            if (username.ToLower() == "ghost") return null;

            return new UserProfile
            {
                DisplayName = "Arun Gudelli",
                Bio = "C# Developer | Tech Blogger",
                Age = 29
            };
        }

        public void UpdateProfile(UserProfile? profile, string? newBio, int? newAge)
        {
            profile?.Bio = newBio;
            if (newAge.HasValue)
                profile?.Age = newAge.Value;
        }
    }
}
```

**Explica√ß√£o:**

- `UserProfile` √© uma classe b√°sica de modelo de dados com propriedades anul√°veis e um m√©todo `Print()` para exibir valores.
- `ProfileService` simula o comportamento da API externa. Se a entrada for `"ghost"`, ele retorna `null`, representando uma resposta com falha ou vazia.
- O m√©todo `UpdateProfile` usa atribui√ß√£o condicional nula para atualizar o perfil com seguran√ßa, sem nenhuma verifica√ß√£o `if ( profile ! = null)` .

Uma li√ß√£o importante aqui √© que ainda podemos chamar `UpdateProfile` com seguran√ßa mesmo se o perfil for `null`.

Normalmente, isso pode levar a uma `NullReferenceException`, mas gra√ßas √† **atribui√ß√£o condicional nula**, as atribui√ß√µes s√£o ignoradas silenciosamente se o objeto for `nulo`.

No m√©todo `UpdateProfile`, usamos instru√ß√µes como `profile?.Bio = newBio`, que garantem que a atribui√ß√£o s√≥ ocorra se o perfil n√£o for `null`.

Mesmo que o chamador passe um perfil `null` (como quando o `user` √© `ghost`), o m√©todo √© executado sem nenhuma exce√ß√£o.

O mesmo vale para a idade: se tivermos um valor n√£o nulo (` int?` ), o atribu√≠mos a `profile ?.Age = newAge.Value`, que novamente ser√° executado somente se o perfil n√£o for `null`.

Este padr√£o de design simplifica a l√≥gica de chamada ‚Äî n√£o h√° necessidade de verificar se h√° nulo antes de cada atualiza√ß√£o.

O pr√≥prio m√©todo de atualiza√ß√£o lida com isso com seguran√ßa, mantendo o c√≥digo organizado e expressivo.

## üöÄ Programa principal: usando as classes com atualiza√ß√µes nulas

```c#
using System;

namespace NullConditionalAssignmentDemo
{
    class Program
    {
        static void Main(string[] args)
        {
            var service = new ProfileService();

            string username1 = "arun";
            string username2 = "ghost";

            var profile1 = service.GetProfileFromApi(username1);
            var profile2 = service.GetProfileFromApi(username2);

            string? updatedBio = "Updated bio from UI";
            int? updatedAge = 30;

            service.UpdateProfile(profile1, updatedBio, updatedAge);
            service.UpdateProfile(profile2, updatedBio, updatedAge);

            Console.WriteLine("Profile 1 (arun):");
            profile1?.Print();

            Console.WriteLine("Profile 2 (ghost):");
            profile2?.Print();
        }
    }
}
```

**Explica√ß√£o:**

- Neste programa principal, simulamos dois cen√°rios:
- Um onde um perfil v√°lido √© retornado (`arun`)
- Outro onde o usu√°rio n√£o existe e o m√©todo retorna `null` (`ghost`)
- Ambos os perfis s√£o passados para o m√©todo `UpdateProfile`.
- O m√©todo cont√©m atribui√ß√µes condicionais nulas como `profile ?.Bio = newBio`, o que significa que a atualiza√ß√£o s√≥ acontece se o perfil n√£o for nulo.
- Mesmo que `profile` seja `null`, o m√©todo ser√° executado com seguran√ßa sem lan√ßar nenhuma exce√ß√£o.
- Isso elimina a necessidade de o chamador verificar se o objeto √© nulo antes de chamar o m√©todo.
- Por fim, usamos `profile?.Print()` para exibir o resultado. Para `arun`, ele imprime o perfil atualizado. Para `ghost`, nada √© impresso, mas nenhum erro √© gerado.
- Isso demonstra como o acesso e a atribui√ß√£o condicional nula fornecem maneiras seguras e leg√≠veis de lidar com objetos possivelmente nulos .

**Sa√≠da**:

```bash
Profile 1 (arun):
DisplayName: Arun Gudelli
Bio: Updated bio from UI
Age: 30
Profile 2 (ghost):
```

## ‚öô Ô∏èComo experimentar este recurso

### ‚úÖ Instalar o .NET 10 Preview 3

Obtenha o SDK em [Downloads do .NET](https://dotnet.microsoft.com/en-us/download/dotnet/10.0).

### ‚úÖ Defina a vers√£o do idioma para visualiza√ß√£o

Atualize seu `.csproj`:

```c#
<PropertyGroup>
  <LangVersion>preview</LangVersion>
</PropertyGroup>
```

### ‚ö† Ô∏è Ainda n√£o suportado no Visual Studio

At√© o momento, o **Visual Studio 2022 v17.14 Preview 2** ainda mostra:

`O lado esquerdo de uma atribui√ß√£o deve ser uma vari√°vel, propriedade ou indexador`

Mesmo com o SDK e LangVersion corretos.

### ‚úÖ Use a CLI `dotnet`

Em vez disso, crie seu projeto usando:

`dotnet build`

Isso funciona perfeitamente com atribui√ß√£o condicional nula usando C# 14.

Ent√£o, at√© que o Visual Studio tenha suporte total no editor, use o CLI `dotnet` para test√°-lo.

## ‚úç Ô∏è Considera√ß√µes finais

Esse pequeno recurso reduz o ru√≠do do c√≥digo, melhora a clareza e protege contra erros de refer√™ncia nula, tudo isso mantendo a eleg√¢ncia.

## üìå TL;DR

- ‚úÖ Introduzido no .NET 10 Preview 3
- üîÅ Atribuir valores somente quando o objeto n√£o for nulo
- üß™ Use `<LangVersion>visualiza√ß√£o</LangVersion>` em `.csproj`
- üß± Ainda n√£o totalmente suportado no Visual Studio
- ‚úÖ Use a CLI `dotnet build` para testar

---
